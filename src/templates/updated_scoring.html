<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!-- <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/tiles.css') }}"
    /> -->

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/global.css') }}"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/updated_scoring.css') }}"
    />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/precheck.css') }}" />

  </head>


  <body>
    <header>
      <p class="level_indicator">Level <span id="level"> : Scoring</span></p>
    </header>

    <div class="updated_scoring_page_container">
      <!-- Mouse Data Score -->
      <div class="updated_scoring_mouse_data_wrapper">
        <h2 class="updated_scoring_mouse_data_title">How You Did</h2>
        <div class="updated_scoring_mouse_data_container">
          <!-- Emoji containers -->

          <div class="updated_scoring_mouse_data_item">

          {% if session.get("AverageEuclidanPercentChange") and (session.get("AverageEuclidanPercentChange") > 30) %}
            <div class="emoji_wrapper active">
            {% else %}
            <div class="emoji_wrapper">
            {% endif %}
              <img
                src="{{ url_for('static', filename='images/verySadYellowEmoji.svg') }}"
              />
            </div>
            <p class="updated_scoring_mouse_data_item_desc">Keep practicing</p>

          </div>


          
          <div class="updated_scoring_mouse_data_item">

            {% if session.get("AverageEuclidanPercentChange") and (session.get("AverageEuclidanPercentChange") > 20) and (session.get("AverageEuclidanPercentChange") <= 30) %}
            <div class="emoji_wrapper active">
            {% else %}
            <div class="emoji_wrapper">
            {% endif %}

              <img
                src="{{ url_for('static', filename='images/sadYellowEmoji.svg') }}"
              />
            </div>
            <!-- <p class="updated_scoring_mouse_data_item_desc">&nbsp;</p> -->
            <p class="updated_scoring_mouse_data_item_desc">You can do better</p>


          </div>



          <div class="updated_scoring_mouse_data_item">

            {% if session.get("AverageEuclidanPercentChange") and (session.get("AverageEuclidanPercentChange") > 10) and (session.get("AverageEuclidanPercentChange") <= 20) %}
            <div class="emoji_wrapper active">
            {% else %}
            <div class="emoji_wrapper">
            {% endif %}


              <img
                src="{{ url_for('static', filename='images/happyGreenEmoji.svg') }}"
              />
            </div>
            <p class="updated_scoring_mouse_data_item_desc">Way to go</p>

          </div>





          <div class="updated_scoring_mouse_data_item">
            <!-- <p class="updated_scoring_mouse_data_item_desc">>10%</p> -->

          {% if session.get("AverageEuclidanPercentChange") and session.get("AverageEuclidanPercentChange") > 0 and session.get("AverageEuclidanPercentChange") <= 10  %}
          <div class="emoji_wrapper active">
          {% else %}
            <div class="emoji_wrapper">
          {% endif %}
              <img
                src="{{ url_for('static', filename='images/veryHappyGreenEmoji.svg') }}"
              />
            </div>
            <p class="updated_scoring_mouse_data_item_desc">You were awesome!</p>
          </div>



        </div>




      </div>

      <br />
      <br />
      <br />

      <!-- Time to Complete -->
      <div class="updated_scoring_ttc_wrapper" style="align-items: center;">
        <h2 class="updated_scoring_ttc_title">Time to Complete Task</h2>
        <div class="updated_scoring_ttc_container">
          <!-- <div class="ttc_expected">
            Expected Time: <span id="ttc_expected">{{ session.get("ExpectedTimeToCompleteLevel")["minutes"] }}:{{ session.get("ExpectedTimeToCompleteLevel")["seconds"] }}</span>
          </div> -->

      <!-- <br />
      <br /> -->

          <div class="ttc_actual" style="text-align: center;">You Took: <span id="ttc_actual">{{ session.get("TimeToCompleteLevel")["ttc_minutes"] }}:{{ session.get("TimeToCompleteLevel")["ttc_seconds"] }}</span></div>
        </div>
      </div>
    </div>


    <!-- <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; width: 100%">
      <input type="text" placeholder="Watch ID" id="watchID_input" />
    </div> -->


        <!-- Bring User to next level -->
        <!-- <div style="display: flex; justify-content: center;">
          <button id="next_level_btn" class="start_button pregame_disabled">
            Next Puzzle
          </button>
        </div> -->

    <div class="pregame_status_container" style="flex-direction: row;">
      <button id="next_level_btn" class="start_button pregame_disabled">
        Next Puzzle
      </button>
      <hr style="width: 2px; height: 30px; display: inline-block; margin: 0px 10px; background-color: black;">
      <button id="watch_status_check_btn" class="start_button">Check Watch Status</button>
      <div class="pregame_watch_status" id="watch_status_text">Offline</div>
      <svg id="watch_status_loading" class="second_spinner" viewBox="0 0 50 50">
        <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
      </svg>

    </div>




  </body>

  <script src="{{ url_for('static', filename='js/helper_functions.js') }}"></script>
  <script src="{{ url_for('static', filename='js/watch_check.js') }}"></script>

  <script>


    const nextLevelBtn = document.getElementById("next_level_btn");
    let g_current_level = Number(getLocalStorage(LOCALSTORAGE_CURR_LEVEL, 1));
    let g_current_sub = Number(getLocalStorage(LOCALSTORAGE_CURR_SUBLEVEL, 1));
    let g_next_level = Number(getLocalStorage(LOCALSTORAGE_NEXT_SUBLEVEL, 1));
    let g_next_sub = Number(getLocalStorage(LOCALSTORAGE_NEXT_SUBLEVEL, 1));

    console.log(g_current_level, g_current_sub, g_next_level, g_next_sub)

    // Calculate the next level to go to
    const next_level_value = g_current_sub >= MINDGAME_MAX_SUBLEVEL ? g_current_level + 1 : g_current_level;
    const next_sublevel_value = g_current_sub >= MINDGAME_MAX_SUBLEVEL ? 1 : g_current_sub + 1;

    console.log(next_level_value, next_sublevel_value)

  </script>


  <script>
    let g_watch_status = false;
    const isEntireGameFinished = g_current_level == MINDGAME_MAX_LEVEL && g_current_sub == MINDGAME_MAX_SUBLEVEL

    // Finished all Levels
    if(isEntireGameFinished){
      nextLevelBtn.classList.remove("pregame_disabled");
      nextLevelBtn.innerHTML = "Finish"
      localStorage.setItem(LOCALSTORAGE_PROGRESS , MINDGAME_PROGRESS_ENUM.HOME);
    }

    // Event listner for the check status button
    g_watch_check_watch_status_btn.addEventListener("click", async () => {
      nextLevelBtn.classList.add("pregame_disabled");


      //localStorage.setItem("watchID", watchID);
      await handleWatchStatusCheck((status) => {
        if (status == "online") {
          g_watch_status = true;
          nextLevelBtn.classList.remove("pregame_disabled");
        } else {
          g_watch_status = false;
          nextLevelBtn.classList.add("pregame_disabled");
        }
      }, getLocalStorageOrNull(LOCALSTORAGE_USERID));
    });

    // Update localStorage so that the next level is displayed on tiles_game page
    nextLevelBtn.addEventListener("click", () => {

      //Done with all levels, send back to home page
      if(isEntireGameFinished){
        window.location.href = `/`;
        return;
      }

      if(nextLevelBtn.classList.contains("pregame_disabled")) return;


      // Start new game on next level
      localStorage.setItem(LOCALSTORAGE_CURR_LEVEL, next_level_value);
      localStorage.setItem(LOCALSTORAGE_CURR_SUBLEVEL, next_sublevel_value); 
      window.location = "/tiles_game";

    });

    // Finished current Level so make sure next level is the next level
    localStorage.setItem(LOCALSTORAGE_NEXT_LEVEL, next_level_value);
    localStorage.setItem(LOCALSTORAGE_NEXT_SUBLEVEL, next_sublevel_value); 



  </script>
</html>


